<!DOCTYPE html>
<html>
<head>
    <title>Beginner Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
	.keyboard {
	    text-align: center;
	}
	
	.key-row {
	    display: flex;
	    justify-content: center;
	    gap: 10px;
	}
	
	.key {
	    width: 45px;
	    height: 45px;
	    border: 1px solid #333;
	    border-radius: 6px;
	    line-height: 45px;
	    font-family: monospace;
	    font-size: 18px;
	    background: #f8f9fa;
	}
	
	/* Finger colors */
	.left-pinky    { background: #f28b82; }
	.left-ring     { background: #fbbc04; }
	.left-middle   { background: #fff475; }
	.left-index    { background: #ccff90; }
	.right-index   { background: #a7ffeb; }
	.right-middle  { background: #aecbfa; }
	.right-ring    { background: #d7aefb; }
	.right-pinky   { background: #fdcfe8; }
	
	/* Active key */
	.key.active {
	    outline: 3px solid black;
	}
	        .correct { color: green; }
	        .incorrect { color: red; }
	        .current { text-decoration: underline; }
	        .typing-text { font-family: monospace; font-size: 18px; white-space: pre; }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5">
    <h3 class="text-center mb-3">Beginner Practice (Home Row)</h3>

    <p id="text" class="typing-text">
    </p>

    <textarea id="input" class="form-control mt-3" rows="3"
              placeholder="Type slowly and accurately"></textarea>
    <button id="nextText" class="btn btn-secondary mt-3">Next Practice Text
	</button>
    <div id="keyboard" class="keyboard mt-4">
	    <div class="key-row">
	        <span class="key left-pinky">a</span>
	        <span class="key left-ring">s</span>
	        <span class="key left-middle">d</span>
	        <span class="key left-index">f</span>
	        <span class="key right-index">j</span>
	        <span class="key right-middle">k</span>
	        <span class="key right-ring">l</span>
	        <span class="key right-pinky">;</span>
	    </div>
	</div>
    

    <p class="mt-3 text-center">
        Focus on accuracy, not speed ðŸ™‚
    </p>
</div>

<script>
const beginnerTexts = [
    "asdf jkl;",
    "a s d f j k l ;",
    "fdsa jkl;",
    "asdf asdf jkl;"
];
function getRandomText(textArray) {
	return textArray[Math.floor(Math.random() * textArray.length)]
}
const text = getRandomText(beginnerTexts);
const container = document.getElementById("text");
const input = document.getElementById("input");

const keys = document.querySelectorAll(".key");

document.addEventListener("keydown", (event) => {
    const pressedKey = event.key;

    keys.forEach(key => {
        key.classList.remove("active");

        if (key.textContent === pressedKey) {
            key.classList.add("active");
        }
    });
});

document.addEventListener("keyup", () => {
    keys.forEach(key => key.classList.remove("active"));
});

container.innerHTML = "";
text.split("").forEach(c => {
    const span = document.createElement("span");
    span.textContent = c;
    container.appendChild(span);
});

input.addEventListener("input", () => {
    const spans = container.querySelectorAll("span");
    const typed = input.value;

    spans.forEach((span, i) => {
        span.className = "";
        if (typed[i] == null && i === typed.length) {
            span.classList.add("current");
        } else if (typed[i] === span.textContent) {
            span.classList.add("correct");
        } else if (typed[i]) {
            span.classList.add("incorrect");
        }
    });
});

document.getElementById("nextText").addEventListener("click", () => {
    location.reload();
});
let finalAccuracy = 0;
let finalWpm = 0;
const nextLevel = decideNextLevel(currentLevel, finalAccuracy, finalWpm);
const messageBox = document.createElement("div");
messageBox.className = "alert alert-info mt-3";
if (nextLevel !== currentLevel) {
    messageBox.textContent =
        `Great job! Youâ€™re ready for ${nextLevel.toUpperCase()} level ðŸš€`;
} else {
    messageBox.textContent =
        "Keep practicing to unlock the next level ðŸ’ª";
}

document.body.appendChild(messageBox);
if (nextLevel !== currentLevel) {
    const btn = document.createElement("a");
    btn.href = `/practice/${nextLevel}`;
    btn.className = "btn btn-success mt-3";
    btn.textContent = `Go to ${nextLevel} practice`;

    document.body.appendChild(btn);
}
</script>

</body>
</html>
